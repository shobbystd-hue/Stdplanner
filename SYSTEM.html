<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM: SHARAD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;700&display=swap');
        
        :root {
            --neon-blue: #0ea5e9;
            --angry-red: #ef4444;
            --bg-dark: #020617;
        }

        body {
            background-color: var(--bg-dark);
            color: #e2e8f0;
            font-family: 'Rajdhani', sans-serif;
            background-image: 
                linear-gradient(rgba(2, 6, 23, 0.95), rgba(2, 6, 23, 0.95)),
                url('https://www.transparenttextures.com/patterns/cubes.png');
            min-height: 100vh;
            overflow-x: hidden;
        }

        .sys-font { font-family: 'Orbitron', sans-serif; letter-spacing: 2px; }
        .text-rage { text-shadow: 0 0 15px var(--angry-red); color: var(--angry-red); animation: shake 0.5s infinite; }
        
        .sys-box {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid #1e293b;
            position: relative;
            transition: all 0.3s;
        }

        /* INPUTS */
        input[type="text"] { 
            background: transparent; border: none; border-bottom: 1px solid #334155; 
            color: white; width: 100%; outline: none; padding: 5px; 
            font-family: 'Rajdhani', sans-serif; text-transform: uppercase; font-weight: bold;
        }
        input[type="text"]:focus { border-color: var(--neon-blue); }

        /* CHECKBOX */
        input[type="checkbox"] {
            appearance: none; width: 20px; height: 20px; border: 2px solid #475569; 
            cursor: pointer; display: grid; place-content: center; transition: all 0.2s;
        }
        input[type="checkbox"]:checked { border-color: var(--neon-blue); background: rgba(14, 165, 233, 0.2); }
        input[type="checkbox"]::before { content: "âœ”"; color: var(--neon-blue); font-weight: bold; transform: scale(0); transition: 100ms transform; }
        input[type="checkbox"]:checked::before { transform: scale(1); }

        /* ANIMATIONS */
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -2px); } }
        .rage-mode { animation: shake 0.5s; border: 2px solid red !important; }
        .rage-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            background: rgba(255, 0, 0, 0.1); display: none; z-index: 50;
            box-shadow: inset 0 0 100px red;
        }
        
        /* DELETE BUTTON */
        .del-btn { opacity: 0; transition: 0.3s; color: #94a3b8; font-size: 10px; cursor: pointer; }
        tr:hover .del-btn { opacity: 1; }
        .del-btn:hover { color: var(--angry-red); }
    </style>
</head>
<body class="p-4 max-w-md mx-auto w-full flex flex-col h-screen" onclick="initAudio()">

    <div id="screen-flash" class="rage-overlay"></div>

    <header class="mb-6 border-b border-slate-800 pb-4">
        <div class="flex justify-between items-end">
            <div>
                <h1 class="text-xs text-red-500 font-bold tracking-[0.3em] mb-1">SYSTEM WARNING</h1>
                <h2 class="text-2xl font-black italic sys-font text-white">PLAYER: <span class="text-sky-400">SHARAD</span></h2>
                <div class="text-[10px] text-slate-500 mt-1">CLASS: SHADOW MONARCH</div>
            </div>
            <div class="text-right">
                <div id="rank-badge" class="text-5xl font-black sys-font text-slate-700 leading-none">E</div>
                <div class="text-[9px] text-slate-500 mt-1 uppercase">Current Status</div>
            </div>
        </div>
        <div id="msg-box" class="mt-4 text-[11px] text-sky-400 font-mono bg-slate-900/50 p-2 border-l-2 border-sky-500">
            > SYSTEM: WELCOME BACK, SHARAD. DO NOT FAIL.
        </div>
    </header>

    <div class="mb-8">
        <div class="flex justify-between text-[10px] mb-1 font-bold uppercase tracking-widest text-slate-500">
            <span>XP Progress</span>
            <span id="mana-text">0 XP</span>
        </div>
        <div class="w-full bg-black h-3 border border-slate-800">
            <div id="exp-bar" class="h-full bg-gradient-to-r from-sky-600 to-sky-400" style="width: 0%"></div>
        </div>
    </div>

    <section class="sys-box p-4 mb-6 relative">
        <div class="absolute -top-3 left-3 bg-[#020617] px-2 text-[10px] text-sky-500 font-bold border border-sky-900">
            [ DAILY MISSIONS ]
        </div>
        <table class="w-full border-collapse">
            <tbody id="quest-list" class="text-sm">
                </tbody>
        </table>
        
        <button onclick="addMission()" class="w-full mt-4 border border-dashed border-slate-700 text-slate-500 text-xs py-2 hover:border-sky-500 hover:text-sky-400 transition-all uppercase tracking-widest">
            [ + ADD NEW MISSION ]
        </button>
    </section>

    <section class="sys-box p-6 text-center mb-6">
        <div class="text-[9px] uppercase tracking-[3px] text-slate-500 mb-2">Gate Collapse Timer</div>
        <div id="timer" class="text-6xl font-black sys-font text-white mb-6">25:00</div>
        
        <div class="flex gap-2" id="timer-controls">
            <button onclick="startTimer(1500)" class="flex-1 bg-sky-700 hover:bg-sky-600 text-white font-black py-4 text-xs tracking-[3px] border border-sky-400 transition-all uppercase skew-x-[-10deg]">
                Enter Gate
            </button>
        </div>
        <button id="coward-btn" onclick="stopTimer()" class="hidden w-full mt-2 border border-red-900 text-red-700 text-[10px] py-2 hover:bg-red-950 hover:text-red-500 uppercase tracking-widest">
            FLEE (COWARD)
        </button>
    </section>

    <div class="mt-auto pb-4">
        <button onclick="punish()" class="w-full bg-transparent border-2 border-red-900/50 text-red-800 font-black py-3 text-xs tracking-[4px] hover:bg-red-950 hover:border-red-600 hover:text-red-500 transition-all uppercase">
            [ I FAILED - ACCEPT PUNISHMENT ]
        </button>
    </div>

    <script>
        let mana = parseInt(localStorage.getItem('sharad_mana')) || 0;
        let countdown;
        let isRunning = false;
        let audioCtx;

        // The List of Tasks (Array of Objects)
        let tasks = [];

        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

        // --- RENDER & LOGIC ---

        function renderTasks() {
            const list = document.getElementById('quest-list');
            list.innerHTML = "";
            
            tasks.forEach((task, index) => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-slate-800/50 group";
                
                tr.innerHTML = `
                    <td class="py-3 w-8">
                        <input type="checkbox" onchange="toggleTask(${index})" ${task.checked ? 'checked' : ''}>
                    </td>
                    <td class="py-3">
                        <input type="text" value="${task.text}" placeholder="ENTER MISSION..." oninput="updateTaskText(${index}, this.value)">
                    </td>
                    <td class="w-6 text-center">
                        <span onclick="deleteTask(${index})" class="del-btn">[x]</span>
                    </td>
                `;
                list.appendChild(tr);
            });
        }

        function addMission() {
            tasks.push({ text: "", checked: false });
            sysMsg("MORE WORK? GOOD. DO IT.", false);
            saveData();
            renderTasks();
        }

        function updateTaskText(index, value) {
            tasks[index].text = value;
            saveData();
        }

        function toggleTask(index) {
            tasks[index].checked = !tasks[index].checked;
            
            if (tasks[index].checked) {
                mana += 200;
                sysMsg("ACCEPTABLE.", false);
                playTone(600, 0.1);
            } else {
                mana -= 200;
                sysMsg("UNDOING PROGRESS? WEAK.", true);
            }
            updateUI();
            saveData();
        }

        function deleteTask(index) {
            if(confirm("DELETE THIS MISSION?")) {
                if(tasks[index].checked) mana -= 200; // Deduct XP if deleting a completed task
                tasks.splice(index, 1);
                updateUI();
                saveData();
                renderTasks();
            }
        }

        function saveData() {
            localStorage.setItem('sharad_tasks', JSON.stringify(tasks));
            localStorage.setItem('sharad_mana', mana);
        }

        function loadData() {
            const storedTasks = JSON.parse(localStorage.getItem('sharad_tasks'));
            if (storedTasks && storedTasks.length > 0) {
                tasks = storedTasks;
            } else {
                // Default tasks for new user
                tasks = [
                    { text: "DAILY WORKOUT", checked: false },
                    { text: "STUDY SESSION", checked: false },
                    { text: "MEDITATION", checked: false }
                ];
            }
            renderTasks();
            updateUI();
        }

        // --- CORE UI & SYSTEM ---

        function updateUI() {
            document.getElementById('mana-text').innerText = mana + " XP";
            let pct = (mana % 2000) / 20; if (pct > 100) pct = 100;
            document.getElementById('exp-bar').style.width = pct + "%";

            const badge = document.getElementById('rank-badge');
            let rank = "E", color = "#334155";
            if (mana > 1000) { rank = "D"; color = "#166534"; }
            if (mana > 3000) { rank = "C"; color = "#0369a1"; }
            if (mana > 8000) { rank = "B"; color = "#7e22ce"; }
            if (mana > 20000) { rank = "A"; color = "#b45309"; }
            if (mana > 50000) { rank = "S"; color = "#e11d48"; }

            badge.innerText = rank;
            badge.style.color = color;
            badge.style.textShadow = `0 0 20px ${color}`;
        }

        function punish() {
            if (confirm("CONFIRM FAILURE? SHARAD, YOU WILL LOSE 1000 XP.")) {
                mana = Math.max(0, mana - 1000);
                updateUI();
                document.getElementById('screen-flash').style.display = 'block';
                document.body.classList.add('rage-mode');
                playTone(100, 0.5);
                sysMsg("SHARAD IS DISAPPOINTING. -1000 XP.", true);
                setTimeout(() => {
                    document.getElementById('screen-flash').style.display = 'none';
                    document.body.classList.remove('rage-mode');
                }, 1000);
                saveData();
            }
        }

        function startTimer(seconds) {
            if (isRunning) return;
            isRunning = true;
            document.getElementById('coward-btn').classList.remove('hidden');
            sysMsg("FOCUS, SHARAD.", false);
            let timeLeft = seconds;
            countdown = setInterval(() => {
                const m = Math.floor(timeLeft / 60);
                const s = timeLeft % 60;
                document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    isRunning = false;
                    document.getElementById('coward-btn').classList.add('hidden');
                    mana += 500; updateUI(); saveData();
                    sysMsg("DUNGEON CLEARED.", false);
                    playTone(800, 0.5);
                }
                timeLeft--;
            }, 1000);
        }

        function stopTimer() {
            if (confirm("ABANDON DUNGEON?")) {
                clearInterval(countdown);
                isRunning = false;
                document.getElementById('timer').innerText = "25:00";
                document.getElementById('coward-btn').classList.add('hidden');
                mana = Math.max(0, mana - 200); updateUI(); saveData();
                sysMsg("COWARDICE DETECTED. -200 XP.", true);
            }
        }

        function sysMsg(text, isAngry) {
            const box = document.getElementById('msg-box');
            box.innerText = "> SYSTEM: " + text;
            if (isAngry) {
                box.className = "mt-4 text-[11px] font-mono bg-slate-900/50 p-2 border-l-2 border-red-500 text-red-500 text-rage";
            } else {
                box.className = "mt-4 text-[11px] font-mono bg-slate-900/50 p-2 border-l-2 border-sky-500 text-sky-400";
            }
        }

        function playTone(freq, dur) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.type = 'sawtooth';
            o.frequency.value = freq;
            g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + dur);
        }

        loadData();
    </script>
</body>
</html>
